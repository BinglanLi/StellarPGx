manifest {
    author = 'David Twesigomwe'
    description = 'Pipeline calls CYP gene star alleles from WGS BAM/CRAM files. Model gene: CYP2D6'
    mainScript = 'main.nf'
    version = '1.0.0'
}



params {
// User-defined parameters

   // reference genome
   ref_file = "/spaces/gerrit/dbs/gatk/bundle/hg38/Homo_sapiens_assembly38.fasta"


   // BAM/CRAM file(s) and respective indexes 
       // example1 (single sample): /dataE/GeT-RM/NA12878*{bam,bai}
       // example2 (multiple samples): /dataE/GeT-RM/*{bam,bai}
       // example3 (CRAM files): /dataE/GeT-RM/HG*{cram,crai}

   in_bam = "/home/david/CypGen-dev/data/hg38/NA18632.final*{cram,crai}" 


   // Output directoy (Default is $PWD/results)
   out_dir = "$PWD/results"


   // DO NOT modify these lines  
   build37db = "$PWD/database/b37"
   build38db = "$PWD/database/hg38"
   build37res = "$PWD/resources/cyp_b37"
   build38res = "$PWD/resources/cyp_hg38"
   build37call = "$PWD/scripts/b37/bin"
   build38call = "$PWD/scripts/hg38/bin"

}



ref_dir_val = new File("${params.ref_file}").getParent()
in_bam_dir = new File("${params.in_bam}").getParent()
out_dir = new File("${params.out_dir}").getParent()


// Singularity options
def singularityOptions() {
    singularity {
        enabled = true

        // runOptions = " --bind $ref_dir_val:/opt,$in_bam_dir:/mnt,$out_dir:/run"
        cacheDir = "$PWD/containers"
        autoMounts = true 
    }
}




process {

// Containers

    container = "$PWD/containers/cypgen-dev.sif"
//     withName: 'call_snvs1' {
//     singularity.runOptions = " --bind $ref_dir_val:/opt,$in_bam_dir:/mnt" + " --cleanenv" 
//     }

//     withName: 'call_snvs2' {
//     singularity.runOptions = " --bind $ref_dir_val:/opt,$in_bam_dir:/mnt" + " --cleanenv"
//     }

//     withName: 'call_sv_del' {
//     singularity.runOptions = " --bind $ref_dir_val:/opt,$in_bam_dir:/mnt" + " --cleanenv"
//     }

//     withName: 'call_sv_dup' {
//     singularity.runOptions = " --bind $ref_dir_val:/opt,$in_bam_dir:/mnt" + " --cleanenv"
//     }

//     withName: 'get_depth' {
//     singularity.runOptions = " --bind $in_bam_dir:/mnt" + " --cleanenv"
//     }

//     withName: 'call_stars' {
//     singularity.runOptions = " --bind $out_dir:/run"
//     }

}


profiles {

    // For execution on a local machine, no containerization. -- Default
    standard {
        process.executor = 'local'
        singularityOptions()
    }


    // For execution on a SLURM scheduler, no containerization.
    slurm {
        process.executor = 'slurm'
        process.queue = 'batch'
        singularityOptions()

    }

}